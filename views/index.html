<!-- This is a static file -->
<!-- served from your routes in server.js -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="A cool thing made with Glitch">

    <title>Test Okta Signin Widget</title>

    <link id="favicon" rel="icon" href="https://glitch.com/edit/favicon-app.ico" type="image/x-icon">
    
    <script src="https://global.oktacdn.com/okta-signin-widget/5.4.0/js/okta-sign-in.min.js" type="text/javascript"></script>

    <link href="https://global.oktacdn.com/okta-signin-widget/5.4.0/css/okta-sign-in.min.css" type="text/css" rel="stylesheet"/>
    <!-- import the webpage's stylesheet -->
    <link rel="stylesheet" href="/style.css">

    <!-- import the webpage's client-side javascript file -->
    <script src="/script.js" defer></script>
  </head>
  <body>
    <div id="okta-login-container"></div> 
        <script type="text/javascript">
          var signIn = new OktaSignIn({
            el: '#okta-login-container',
            baseUrl : 'https://sathishb.okta.com',
            clientId : '0oaafj1e3jBIA1FSE2p7',
            redirectUri : 'https://sathish-widget.glitch.me/callback',
            authParams : {                  
              issuer: 'https://sathishb.okta.com/oauth2/default',
              pkce: false;
              responseType : 'code',
              // `display: page` will initiate the OAuth2 page redirect flow
              display : 'page',
              scopes : [  'openid','email','profile','address','phone', 'offline_access' ]
            },
            authScheme : 'OAUTH2',                
            features : {
              registration : true,
              rememberMe : true,
              smsRecovery : true,
              multiOptionalFactorEnroll : true,
              selfServiceUnlock : true,
              autoPush : true,
              idpDiscovery: false,
              passwordlessAuth: true
            }
          });

          // The user has just landed on our login form, and has not yet authenticated
          if (!signIn.hasTokensInUrl()) {
            console.log('User is yet to authenticate');
            signIn.renderEl({
              el : '#okta-login-container'
            },
            function(res) {
              if (res.status === 'SUCCESS') {
                console.log('Authentication success');
                res.session.setCookieAndRedirect(orgUrl);
              }
              if (res.status !== 'SUCCESS') { 
                console.log('Authentication fail');
                return;
              }
            });
          }
          // The user has redirected back after authenticating and has their access or ID Token in the URL.
          else {
            console.log('User has already authenticated');
            signIn.parseTokensFromUrl(function success(res) {
              console.log('Authentication success');
              signIn.tokenManager.add('my_access_token',res);
            },
            function error(err) {
              console.log('Authentication fail');
              handleError(err);
            });
          }
      </script>
  </body>
</html>
